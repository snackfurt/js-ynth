var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function i(e){e.forEach(t)}function o(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e,t,n,i){return e[1]&&i?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](i(t))):n.ctx}function a(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode.removeChild(e)}function d(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function l(){return h(" ")}function f(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function p(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function v(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function m(e,t,n,i){e.style.setProperty(t,n,i?"important":"")}function g(e,t,n){e.classList[n?"add":"remove"](t)}let N;function b(e){N=e}function y(e){(function(){if(!N)throw new Error("Function called outside component initialization");return N})().$$.on_mount.push(e)}const x=[],G=[],w=[],$=[],I=Promise.resolve();let U=!1;function S(e){w.push(e)}function k(e){$.push(e)}let R=!1;const E=new Set;function L(){if(!R){R=!0;do{for(let e=0;e<x.length;e+=1){const t=x[e];b(t),D(t.$$)}for(b(null),x.length=0;G.length;)G.pop()();for(let e=0;e<w.length;e+=1){const t=w[e];E.has(t)||(E.add(t),t())}w.length=0}while(x.length);for(;$.length;)$.pop()();U=!1,R=!1,E.clear()}}function D(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(S)}}const T=new Set;let O;function P(){O={r:0,c:[],p:O}}function C(){O.r||i(O.c),O=O.p}function j(e,t){e&&e.i&&(T.delete(e),e.i(t))}function M(e,t,n,i){if(e&&e.o){if(T.has(e))return;T.add(e),O.c.push((()=>{T.delete(e),i&&(n&&e.d(1),i())})),e.o(t)}}function F(e,t,n){const i=e.$$.props[t];void 0!==i&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}function A(e){e&&e.c()}function z(e,n,s,r){const{fragment:a,on_mount:c,on_destroy:u,after_update:d}=e.$$;a&&a.m(n,s),r||S((()=>{const n=c.map(t).filter(o);u?u.push(...n):i(n),e.$$.on_mount=[]})),d.forEach(S)}function q(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function W(e,t){-1===e.$$.dirty[0]&&(x.push(e),U||(U=!0,I.then(L)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function V(t,o,s,r,a,c,d,h=[-1]){const l=N;b(t);const f=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(l?l.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:o.target||l.$$.root};d&&d(f.root);let p=!1;if(f.ctx=s?s(t,o.props||{},((e,n,...i)=>{const o=i.length?i[0]:n;return f.ctx&&a(f.ctx[e],f.ctx[e]=o)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](o),p&&W(t,e)),n})):[],f.update(),p=!0,i(f.before_update),f.fragment=!!r&&r(f.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);f.fragment&&f.fragment.l(e),e.forEach(u)}else f.fragment&&f.fragment.c();o.intro&&j(t.$$.fragment),z(t,o.target,o.anchor,o.customElement),L()}b(l)}class _{$destroy(){q(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function H(e){let t,n,i;return{c(){t=d("button"),t.textContent="❌",p(t,"class","remove-button svelte-2h8in5")},m(s,r){c(s,t,r),n||(i=f(t,"click",(function(){o(e[2])&&e[2].apply(this,arguments)})),n=!0)},p(t,n){e=t},d(e){e&&u(t),n=!1,i()}}}function B(e){let t;return{c(){t=d("span"),t.textContent="↧",p(t,"class","icon svelte-2h8in5")},m(e,n){c(e,t,n)},d(e){e&&u(t)}}}function Y(e){let t;return{c(){t=d("span"),t.textContent="↥",p(t,"class","icon svelte-2h8in5")},m(e,n){c(e,t,n)},d(e){e&&u(t)}}}function Q(e){let t,n,i,o,s,m,N,b,y,x,G,w,$=e[2]&&H(e);function I(e,t){return e[0]?Y:B}let U=I(e),S=U(e);const k=e[4].default,R=function(e,t,n,i){if(e){const o=r(e,t,n,i);return e[0](o)}}(k,e,e[3],null);return{c(){t=d("div"),n=d("div"),$&&$.c(),i=l(),o=d("button"),s=d("span"),m=h(e[1]),N=l(),S.c(),b=l(),y=d("section"),R&&R.c(),p(s,"class","heading svelte-2h8in5"),p(o,"class","panel-button svelte-2h8in5"),p(n,"class","panel-header svelte-2h8in5"),p(y,"class","panel-content svelte-2h8in5"),g(y,"open-panel",e[0]),p(t,"class","panel")},m(r,u){c(r,t,u),a(t,n),$&&$.m(n,null),a(n,i),a(n,o),a(o,s),a(s,m),a(o,N),S.m(o,null),a(t,b),a(t,y),R&&R.m(y,null),x=!0,G||(w=f(o,"click",e[5]),G=!0)},p(e,[t]){e[2]?$?$.p(e,t):($=H(e),$.c(),$.m(n,i)):$&&($.d(1),$=null),(!x||2&t)&&v(m,e[1]),U!==(U=I(e))&&(S.d(1),S=U(e),S&&(S.c(),S.m(o,null))),R&&R.p&&(!x||8&t)&&function(e,t,n,i,o,s){if(o){const a=r(t,n,i,s);e.p(a,o)}}(R,k,e,e[3],x?function(e,t,n,i){if(e[2]&&i){const o=e[2](i(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let i=0;i<n;i+=1)e[i]=t.dirty[i]|o[i];return e}return t.dirty|o}return t.dirty}(k,e[3],t,null):function(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}(e[3]),null),1&t&&g(y,"open-panel",e[0])},i(e){x||(j(R,e),x=!0)},o(e){M(R,e),x=!1},d(e){e&&u(t),$&&$.d(),S.d(),R&&R.d(e),G=!1,w()}}}function X(e,t,n){let{$$slots:i={},$$scope:o}=t,{heading:s}=t,{isOpen:r}=t,{removeHandler:a=null}=t;return e.$$set=e=>{"heading"in e&&n(1,s=e.heading),"isOpen"in e&&n(0,r=e.isOpen),"removeHandler"in e&&n(2,a=e.removeHandler),"$$scope"in e&&n(3,o=e.$$scope)},[r,s,a,o,i,()=>n(0,r=!r)]}class J extends _{constructor(e){super(),V(this,e,X,Q,s,{heading:1,isOpen:0,removeHandler:2})}}function K(t){let n,o,s,r,g,N,b,y,x,G,w,$,I,U,S,k,R,E=(t[3]??t[0])+"";return{c(){n=d("div"),o=d("div"),s=h(t[1]),r=l(),g=d("div"),N=l(),b=d("div"),y=h(E),x=l(),G=h(t[2]),w=l(),$=d("div"),I=d("button"),I.innerHTML='<span class="icon">+</span>',U=l(),S=d("button"),S.innerHTML='<span class="icon">−</span>',p(o,"class","label svelte-1bbxrds"),p(g,"class","knob center svelte-1bbxrds"),m(g,"--rotation",t[4]),p(b,"class","label svelte-1bbxrds"),p(I,"class","stepButton svelte-1bbxrds"),p(S,"class","stepButton svelte-1bbxrds"),p($,"class","stepButtonContainer svelte-1bbxrds"),p(n,"class","knobContainer svelte-1bbxrds")},m(e,i){c(e,n,i),a(n,o),a(o,s),a(n,r),a(n,g),a(n,N),a(n,b),a(b,y),a(b,x),a(b,G),a(n,w),a(n,$),a($,I),a($,U),a($,S),k||(R=[f(g,"pointerdown",t[5]),f(I,"pointerdown",t[6]),f(S,"pointerdown",t[7])],k=!0)},p(e,[t]){2&t&&v(s,e[1]),16&t&&m(g,"--rotation",e[4]),9&t&&E!==(E=(e[3]??e[0])+"")&&v(y,E),4&t&&v(G,e[2])},i:e,o:e,d(e){e&&u(n),k=!1,i(R)}}}function Z(e,t,n){let i,o,s,r,a,c,{value:u,min:d,max:h}=t,{rotRange:l=2*Math.PI*.83}=t,{pixelRange:f=200}=t,{startRotation:p=.83*-Math.PI}=t,{title:v=""}=t,{unit:m=""}=t,{outputValue:g=null}=t;function N({clientY:e}){n(0,u=function(e,t,n){return Math.round(Math.max(t,Math.min(e,n)))}(r-i*(e-s)/f,d,h))}function b(){window.removeEventListener("pointermove",N),window.removeEventListener("pointerup",b)}function y(){a=!1,clearTimeout(c),window.removeEventListener("pointerup",y)}function x(){a&&u<h&&(n(0,u+=1),c=setTimeout(x,300))}function G(){a&&u>d&&(n(0,u-=1),c=setTimeout(G,300))}return e.$$set=e=>{"value"in e&&n(0,u=e.value),"min"in e&&n(8,d=e.min),"max"in e&&n(9,h=e.max),"rotRange"in e&&n(10,l=e.rotRange),"pixelRange"in e&&n(11,f=e.pixelRange),"startRotation"in e&&n(12,p=e.startRotation),"title"in e&&n(1,v=e.title),"unit"in e&&n(2,m=e.unit),"outputValue"in e&&n(3,g=e.outputValue)},e.$$.update=()=>{768&e.$$.dirty&&n(13,i=h-d),13569&e.$$.dirty&&n(4,o=p+(u-d)/i*l)},[u,v,m,g,o,function({clientY:e}){s=e,r=u,window.addEventListener("pointermove",N),window.addEventListener("pointerup",b)},function(){a=!0,x(),window.addEventListener("pointerup",y)},function(){a=!0,G(),window.addEventListener("pointerup",y)},d,h,l,f,p,i]}class ee extends _{constructor(e){super(),V(this,e,Z,K,s,{value:0,min:8,max:9,rotRange:10,pixelRange:11,startRotation:12,title:1,unit:2,outputValue:3})}}var te="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var ne,ie,oe=(ne=function(e){!function(t){function n(e,t){this.options={},e=e||this.options;var n={frequency:350,peak:1};for(var i in this.inputNode=this.filterNode=r.context.createBiquadFilter(),this.filterNode.type=t,this.outputNode=s.context.createGain(),this.filterNode.connect(this.outputNode),n)this[i]=e[i],this[i]=void 0===this[i]||null===this[i]?n[i]:this[i]}function i(){var e,t,n=r.context.sampleRate*this.time,i=s.context.createBuffer(2,n,r.context.sampleRate),o=i.getChannelData(0),a=i.getChannelData(1);for(t=0;n>t;t++)e=this.reverse?n-t:t,o[t]=(2*Math.random()-1)*Math.pow(1-e/n,this.decay),a[t]=(2*Math.random()-1)*Math.pow(1-e/n,this.decay);this.reverbNode.buffer&&(this.inputNode.disconnect(this.reverbNode),this.reverbNode.disconnect(this.wetGainNode),this.reverbNode=s.context.createConvolver(),this.inputNode.connect(this.reverbNode),this.reverbNode.connect(this.wetGainNode)),this.reverbNode.buffer=i}function o(e){for(var t=r.context.sampleRate,n=new Float32Array(t),i=Math.PI/180,o=0;t>o;o++){var s=2*o/t-1;n[o]=(3+e)*s*20*i/(Math.PI+e*Math.abs(s))}return n}var s={},r=s;e.exports?e.exports=s:t.Pizzicato=t.Pz=s;var a=t.AudioContext||t.webkitAudioContext;if(a){s.context=new a;var c=s.context.createGain();c.connect(s.context.destination),s.Util={isString:function(e){return"[object String]"===toString.call(e)},isObject:function(e){return"[object Object]"===toString.call(e)},isFunction:function(e){return"[object Function]"===toString.call(e)},isNumber:function(e){return"[object Number]"===toString.call(e)&&e===+e},isArray:function(e){return"[object Array]"===toString.call(e)},isInRange:function(e,t,n){return!!(r.Util.isNumber(e)&&r.Util.isNumber(t)&&r.Util.isNumber(n))&&e>=t&&n>=e},isBool:function(e){return"boolean"==typeof e},isOscillator:function(e){return e&&"[object OscillatorNode]"===e.toString()},isAudioBufferSourceNode:function(e){return e&&"[object AudioBufferSourceNode]"===e.toString()},isSound:function(e){return e instanceof r.Sound},isEffect:function(e){for(var t in s.Effects)if(e instanceof s.Effects[t])return!0;return!1},normalize:function(e,t,n){return r.Util.isNumber(e)&&r.Util.isNumber(t)&&r.Util.isNumber(n)?(n-t)*e/1+t:void 0},getDryLevel:function(e){return!r.Util.isNumber(e)||e>1||0>e?0:.5>=e?1:1-2*(e-.5)},getWetLevel:function(e){return!r.Util.isNumber(e)||e>1||0>e?0:e>=.5?1:1-2*(.5-e)}};var u=s.context.createGain(),d=Object.getPrototypeOf(Object.getPrototypeOf(u)),h=d.connect;d.connect=function(e){var t=r.Util.isEffect(e)?e.inputNode:e;return h.call(this,t),e},Object.defineProperty(s,"volume",{enumerable:!0,get:function(){return c.gain.value},set:function(e){r.Util.isInRange(e,0,1)&&c&&(c.gain.value=e)}}),Object.defineProperty(s,"masterGainNode",{enumerable:!1,get:function(){return c},set:function(e){console.error("Can't set the master gain node")}}),s.Events={on:function(e,t,n){e&&t&&(this._events=this._events||{},(this._events[e]||(this._events[e]=[])).push({callback:t,context:n||this,handler:this}))},trigger:function(e){var t,n,i,o;if(e&&(this._events=this._events||{},t=this._events[e]||(this._events[e]=[]))){for(n=Math.max(0,arguments.length-1),i=[],o=0;n>o;o++)i[o]=arguments[o+1];for(o=0;o<t.length;o++)t[o].callback.apply(t[o].context,i)}},off:function(e){e?this._events[e]=void 0:this._events={}}},s.Sound=function(e,t){function n(e,t){e=e||{},this.getRawSourceNode=function(){var t=this.sourceNode?this.sourceNode.frequency.value:e.frequency,n=s.context.createOscillator();return n.type=e.type||"sine",n.frequency.value=t||440,n},this.sourceNode=this.getRawSourceNode(),this.sourceNode.gainSuccessor=r.context.createGain(),this.sourceNode.connect(this.sourceNode.gainSuccessor),c.isFunction(t)&&t()}function i(e,t){e=c.isArray(e)?e:[e];var n=new XMLHttpRequest;n.open("GET",e[0],!0),n.responseType="arraybuffer",n.onload=function(n){s.context.decodeAudioData(n.target.response,function(e){a.getRawSourceNode=function(){var t=s.context.createBufferSource();return t.loop=this.loop,t.buffer=e,t},c.isFunction(t)&&t()}.bind(a),function(n){return console.error("Error decoding audio file "+e[0]),e.length>1?(e.shift(),void i(e,t)):(n=n||new Error("Error decoding audio file "+e[0]),void(c.isFunction(t)&&t(n)))}.bind(a))},n.onreadystatechange=function(t){4===n.readyState&&200!==n.status&&console.error("Error while fetching "+e[0]+". "+n.statusText)},n.send()}function o(e,t){var n=c.isFunction(e)?e:e.audioFunction,i=c.isObject(e)&&e.bufferSize?e.bufferSize:null;if(!i)try{s.context.createScriptProcessor()}catch(e){i=2048}this.getRawSourceNode=function(){var e=s.context.createScriptProcessor(i,1,1);return e.onaudioprocess=n,e}}var a=this,c=s.Util,u=function(e){if(e&&!c.isFunction(e)&&!c.isString(e)&&!c.isObject(e))return"Description type not supported. Initialize a sound using an object, a function or a string.";if(c.isObject(e)){if(!c.isString(e.source)||-1===["wave","file","input","script","sound"].indexOf(e.source))return"Specified source not supported. Sources can be wave, file, input or script";if(!("file"!==e.source||e.options&&e.options.path))return"A path is needed for sounds with a file source";if(!("script"!==e.source||e.options&&e.options.audioFunction))return"An audio function is needed for sounds with a script source"}}(e),d=c.isObject(e)&&c.isObject(e.options);if(u)throw console.error(u),new Error("Error initializing Pizzicato Sound: "+u);this.detached=d&&e.options.detached,this.masterVolume=s.context.createGain(),this.fadeNode=s.context.createGain(),this.fadeNode.gain.value=0,this.detached||this.masterVolume.connect(s.masterGainNode),this.lastTimePlayed=0,this.effects=[],this.effectConnectors=[],this.playing=this.paused=!1,this.loop=d&&e.options.loop,this.attack=d&&c.isNumber(e.options.attack)?e.options.attack:.04,this.volume=d&&c.isNumber(e.options.volume)?e.options.volume:1,d&&c.isNumber(e.options.release)?this.release=e.options.release:d&&c.isNumber(e.options.sustain)?(console.warn("'sustain' is deprecated. Use 'release' instead."),this.release=e.options.sustain):this.release=.04,e?c.isString(e)?i.bind(this)(e,t):c.isFunction(e)?o.bind(this)(e,t):"file"===e.source?i.bind(this)(e.options.path,t):"wave"===e.source?n.bind(this)(e.options,t):"input"===e.source?function(e,t){if(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia||navigator.mediaDevices.getUserMedia){var n=function(e){a.getRawSourceNode=function(){return s.context.createMediaStreamSource(e)},c.isFunction(t)&&t()}.bind(a),i=function(e){c.isFunction(t)&&t(e)};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(n).catch(i):navigator.getUserMedia({audio:!0},n,i)}else console.error("Your browser does not support getUserMedia")}.bind(this)(e,t):"script"===e.source?o.bind(this)(e.options,t):"sound"===e.source&&function(e,t){this.getRawSourceNode=e.sound.getRawSourceNode,e.sound.sourceNode&&r.Util.isOscillator(e.sound.sourceNode)&&(this.sourceNode=this.getRawSourceNode(),this.frequency=e.sound.frequency)}.bind(this)(e.options,t):n.bind(this)({},t)},s.Sound.prototype=Object.create(s.Events,{play:{enumerable:!0,value:function(e,t){this.playing||(r.Util.isNumber(t)||(t=this.offsetTime||0),r.Util.isNumber(e)||(e=0),this.playing=!0,this.paused=!1,this.sourceNode=this.getSourceNode(),this.applyAttack(),r.Util.isFunction(this.sourceNode.start)&&(this.lastTimePlayed=s.context.currentTime-t,this.sourceNode.start(r.context.currentTime+e,t)),this.trigger("play"))}},stop:{enumerable:!0,value:function(){(this.paused||this.playing)&&(this.paused=this.playing=!1,this.stopWithRelease(),this.offsetTime=0,this.trigger("stop"))}},pause:{enumerable:!0,value:function(){if(!this.paused&&this.playing){this.paused=!0,this.playing=!1,this.stopWithRelease();var e=r.context.currentTime-this.lastTimePlayed;this.sourceNode.buffer?this.offsetTime=e%(this.sourceNode.buffer.length/r.context.sampleRate):this.offsetTime=e,this.trigger("pause")}}},clone:{enumerable:!0,value:function(){for(var e=new s.Sound({source:"sound",options:{loop:this.loop,attack:this.attack,release:this.release,volume:this.volume,sound:this}}),t=0;t<this.effects.length;t++)e.addEffect(this.effects[t]);return e}},onEnded:{enumerable:!0,value:function(e){return function(){this.sourceNode&&this.sourceNode!==e||(this.playing&&this.stop(),this.paused||this.trigger("end"))}}},addEffect:{enumerable:!0,value:function(e){if(!r.Util.isEffect(e))return console.error("The object provided is not a Pizzicato effect."),this;this.effects.push(e);var t=this.effectConnectors.length>0?this.effectConnectors[this.effectConnectors.length-1]:this.fadeNode;t.disconnect(),t.connect(e);var n=r.context.createGain();return this.effectConnectors.push(n),e.connect(n),n.connect(this.masterVolume),this}},removeEffect:{enumerable:!0,value:function(e){var t=this.effects.indexOf(e);if(-1===t)return console.warn("Cannot remove effect that is not applied to this sound."),this;var n=this.playing;n&&this.pause();var i=0===t?this.fadeNode:this.effectConnectors[t-1];i.disconnect();var o,s=this.effectConnectors[t];return s.disconnect(),e.disconnect(s),this.effectConnectors.splice(t,1),this.effects.splice(t,1),o=t>this.effects.length-1||0===this.effects.length?this.masterVolume:this.effects[t],i.connect(o),n&&this.play(),this}},connect:{enumerable:!0,value:function(e){return this.masterVolume.connect(e),this}},disconnect:{enumerable:!0,value:function(e){return this.masterVolume.disconnect(e),this}},connectEffects:{enumerable:!0,value:function(){for(var e=[],t=0;t<this.effects.length;t++){var n=t===this.effects.length-1?this.masterVolume:this.effects[t+1].inputNode;e[t]=r.context.createGain(),this.effects[t].outputNode.disconnect(this.effectConnectors[t]),this.effects[t].outputNode.connect(n)}}},volume:{enumerable:!0,get:function(){return this.masterVolume?this.masterVolume.gain.value:void 0},set:function(e){r.Util.isInRange(e,0,1)&&this.masterVolume&&(this.masterVolume.gain.value=e)}},frequency:{enumerable:!0,get:function(){return this.sourceNode&&r.Util.isOscillator(this.sourceNode)?this.sourceNode.frequency.value:null},set:function(e){this.sourceNode&&r.Util.isOscillator(this.sourceNode)&&(this.sourceNode.frequency.value=e)}},sustain:{enumerable:!0,get:function(){return console.warn("'sustain' is deprecated. Use 'release' instead."),this.release},set:function(e){console.warn("'sustain' is deprecated. Use 'release' instead."),r.Util.isInRange(e,0,10)&&(this.release=e)}},getSourceNode:{enumerable:!0,value:function(){if(this.sourceNode){var e=this.sourceNode;e.gainSuccessor.gain.setValueAtTime(e.gainSuccessor.gain.value,r.context.currentTime),e.gainSuccessor.gain.linearRampToValueAtTime(1e-4,r.context.currentTime+.2),setTimeout((function(){e.disconnect(),e.gainSuccessor.disconnect()}),200)}var t=this.getRawSourceNode();return t.gainSuccessor=r.context.createGain(),t.connect(t.gainSuccessor),t.gainSuccessor.connect(this.fadeNode),this.fadeNode.connect(this.getInputNode()),r.Util.isAudioBufferSourceNode(t)&&(t.onended=this.onEnded(t).bind(this)),t}},getInputNode:{enumerable:!0,value:function(){return this.effects.length>0?this.effects[0].inputNode:this.masterVolume}},applyAttack:{enumerable:!1,value:function(){if(this.fadeNode.gain.value,this.fadeNode.gain.cancelScheduledValues(r.context.currentTime),this.attack){var e=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,t=this.attack;e||(t=(1-this.fadeNode.gain.value)*this.attack),this.fadeNode.gain.setTargetAtTime(1,r.context.currentTime,2*t)}else this.fadeNode.gain.setTargetAtTime(1,r.context.currentTime,.001)}},stopWithRelease:{enumerable:!1,value:function(e){var t=this.sourceNode,n=function(){return r.Util.isFunction(t.stop)?t.stop(0):t.disconnect()};if(this.fadeNode.gain.value,this.fadeNode.gain.cancelScheduledValues(r.context.currentTime),!this.release)return this.fadeNode.gain.setTargetAtTime(0,r.context.currentTime,.001),void n();var i=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,o=this.release;i||(o=this.fadeNode.gain.value*this.release),this.fadeNode.gain.setTargetAtTime(1e-5,r.context.currentTime,o/5),window.setTimeout((function(){n()}),1e3*o)}}}),s.Group=function(e){e=e||[],this.mergeGainNode=r.context.createGain(),this.masterVolume=r.context.createGain(),this.sounds=[],this.effects=[],this.effectConnectors=[],this.mergeGainNode.connect(this.masterVolume),this.masterVolume.connect(r.masterGainNode);for(var t=0;t<e.length;t++)this.addSound(e[t])},s.Group.prototype=Object.create(r.Events,{connect:{enumerable:!0,value:function(e){return this.masterVolume.connect(e),this}},disconnect:{enumerable:!0,value:function(e){return this.masterVolume.disconnect(e),this}},addSound:{enumerable:!0,value:function(e){return r.Util.isSound(e)?this.sounds.indexOf(e)>-1?void console.warn("The Pizzicato.Sound object was already added to this group"):e.detached?void console.warn("Groups do not support detached sounds. You can manually create an audio graph to group detached sounds together."):(e.disconnect(r.masterGainNode),e.connect(this.mergeGainNode),void this.sounds.push(e)):void console.error("You can only add Pizzicato.Sound objects")}},removeSound:{enumerable:!0,value:function(e){var t=this.sounds.indexOf(e);return-1===t?void console.warn("Cannot remove a sound that is not part of this group."):(e.disconnect(this.mergeGainNode),e.connect(r.masterGainNode),void this.sounds.splice(t,1))}},volume:{enumerable:!0,get:function(){return this.masterVolume?this.masterVolume.gain.value:void 0},set:function(e){r.Util.isInRange(e,0,1)&&(this.masterVolume.gain.value=e)}},play:{enumerable:!0,value:function(){for(var e=0;e<this.sounds.length;e++)this.sounds[e].play();this.trigger("play")}},stop:{enumerable:!0,value:function(){for(var e=0;e<this.sounds.length;e++)this.sounds[e].stop();this.trigger("stop")}},pause:{enumerable:!0,value:function(){for(var e=0;e<this.sounds.length;e++)this.sounds[e].pause();this.trigger("pause")}},addEffect:{enumerable:!0,value:function(e){if(!r.Util.isEffect(e))return console.error("The object provided is not a Pizzicato effect."),this;this.effects.push(e);var t=this.effectConnectors.length>0?this.effectConnectors[this.effectConnectors.length-1]:this.mergeGainNode;t.disconnect(),t.connect(e);var n=r.context.createGain();return this.effectConnectors.push(n),e.connect(n),n.connect(this.masterVolume),this}},removeEffect:{enumerable:!0,value:function(e){var t=this.effects.indexOf(e);if(-1===t)return console.warn("Cannot remove effect that is not applied to this group."),this;var n=0===t?this.mergeGainNode:this.effectConnectors[t-1];n.disconnect();var i,o=this.effectConnectors[t];return o.disconnect(),e.disconnect(o),this.effectConnectors.splice(t,1),this.effects.splice(t,1),i=t>this.effects.length-1||0===this.effects.length?this.masterVolume:this.effects[t],n.connect(i),this}}}),s.Effects={};var l=Object.create(null,{connect:{enumerable:!0,value:function(e){return this.outputNode.connect(e),this}},disconnect:{enumerable:!0,value:function(e){return this.outputNode.disconnect(e),this}}});s.Effects.Delay=function(e){this.options={},e=e||this.options;var t={feedback:.5,time:.3,mix:.5};for(var n in this.inputNode=s.context.createGain(),this.outputNode=s.context.createGain(),this.dryGainNode=s.context.createGain(),this.wetGainNode=s.context.createGain(),this.feedbackGainNode=s.context.createGain(),this.delayNode=s.context.createDelay(),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.delayNode.connect(this.feedbackGainNode),this.feedbackGainNode.connect(this.delayNode),this.inputNode.connect(this.delayNode),this.delayNode.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]},s.Effects.Delay.prototype=Object.create(l,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.mix=e,this.dryGainNode.gain.value=s.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=s.Util.getWetLevel(this.mix))}},time:{enumerable:!0,get:function(){return this.options.time},set:function(e){r.Util.isInRange(e,0,180)&&(this.options.time=e,this.delayNode.delayTime.value=e)}},feedback:{enumerable:!0,get:function(){return this.options.feedback},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.feedback=parseFloat(e,10),this.feedbackGainNode.gain.value=this.feedback)}}}),s.Effects.Compressor=function(e){this.options={},e=e||this.options;var t={threshold:-24,knee:30,attack:.003,release:.25,ratio:12};for(var n in this.inputNode=this.compressorNode=s.context.createDynamicsCompressor(),this.outputNode=s.context.createGain(),this.compressorNode.connect(this.outputNode),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]},s.Effects.Compressor.prototype=Object.create(l,{threshold:{enumerable:!0,get:function(){return this.compressorNode.threshold.value},set:function(e){s.Util.isInRange(e,-100,0)&&(this.compressorNode.threshold.value=e)}},knee:{enumerable:!0,get:function(){return this.compressorNode.knee.value},set:function(e){s.Util.isInRange(e,0,40)&&(this.compressorNode.knee.value=e)}},attack:{enumerable:!0,get:function(){return this.compressorNode.attack.value},set:function(e){s.Util.isInRange(e,0,1)&&(this.compressorNode.attack.value=e)}},release:{enumerable:!0,get:function(){return this.compressorNode.release.value},set:function(e){s.Util.isInRange(e,0,1)&&(this.compressorNode.release.value=e)}},ratio:{enumerable:!0,get:function(){return this.compressorNode.ratio.value},set:function(e){s.Util.isInRange(e,1,20)&&(this.compressorNode.ratio.value=e)}},getCurrentGainReduction:function(){return this.compressorNode.reduction}}),s.Effects.LowPassFilter=function(e){n.call(this,e,"lowpass")},s.Effects.HighPassFilter=function(e){n.call(this,e,"highpass")};var f=Object.create(l,{frequency:{enumerable:!0,get:function(){return this.filterNode.frequency.value},set:function(e){s.Util.isInRange(e,10,22050)&&(this.filterNode.frequency.value=e)}},peak:{enumerable:!0,get:function(){return this.filterNode.Q.value},set:function(e){s.Util.isInRange(e,1e-4,1e3)&&(this.filterNode.Q.value=e)}}});s.Effects.LowPassFilter.prototype=f,s.Effects.HighPassFilter.prototype=f,s.Effects.Distortion=function(e){this.options={},e=e||this.options;var t={gain:.5};for(var n in this.waveShaperNode=s.context.createWaveShaper(),this.inputNode=this.outputNode=this.waveShaperNode,t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]},s.Effects.Distortion.prototype=Object.create(l,{gain:{enumerable:!0,get:function(){return this.options.gain},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.gain=e,this.adjustGain())}},adjustGain:{writable:!1,configurable:!1,enumerable:!1,value:function(){for(var e,t=r.Util.isNumber(this.options.gain)?parseInt(100*this.options.gain,10):50,n=44100,i=new Float32Array(n),o=Math.PI/180,s=0;n>s;++s)e=2*s/n-1,i[s]=(3+t)*e*20*o/(Math.PI+t*Math.abs(e));this.waveShaperNode.curve=i}}}),s.Effects.Flanger=function(e){this.options={},e=e||this.options;var t={time:.45,speed:.2,depth:.1,feedback:.1,mix:.5};for(var n in this.inputNode=s.context.createGain(),this.outputNode=s.context.createGain(),this.inputFeedbackNode=s.context.createGain(),this.wetGainNode=s.context.createGain(),this.dryGainNode=s.context.createGain(),this.delayNode=s.context.createDelay(),this.oscillatorNode=s.context.createOscillator(),this.gainNode=s.context.createGain(),this.feedbackNode=s.context.createGain(),this.oscillatorNode.type="sine",this.inputNode.connect(this.inputFeedbackNode),this.inputNode.connect(this.dryGainNode),this.inputFeedbackNode.connect(this.delayNode),this.inputFeedbackNode.connect(this.wetGainNode),this.delayNode.connect(this.wetGainNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.inputFeedbackNode),this.oscillatorNode.connect(this.gainNode),this.gainNode.connect(this.delayNode.delayTime),this.dryGainNode.connect(this.outputNode),this.wetGainNode.connect(this.outputNode),this.oscillatorNode.start(0),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]},s.Effects.Flanger.prototype=Object.create(l,{time:{enumberable:!0,get:function(){return this.options.time},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.time=e,this.delayNode.delayTime.value=r.Util.normalize(e,.001,.02))}},speed:{enumberable:!0,get:function(){return this.options.speed},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.speed=e,this.oscillatorNode.frequency.value=r.Util.normalize(e,.5,5))}},depth:{enumberable:!0,get:function(){return this.options.depth},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.depth=e,this.gainNode.gain.value=r.Util.normalize(e,5e-4,.005))}},feedback:{enumberable:!0,get:function(){return this.options.feedback},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.feedback=e,this.feedbackNode.gain.value=r.Util.normalize(e,0,.8))}},mix:{enumberable:!0,get:function(){return this.options.mix},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.mix=e,this.dryGainNode.gain.value=s.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=s.Util.getWetLevel(this.mix))}}}),s.Effects.StereoPanner=function(e){this.options={},e=e||this.options;var t={pan:0};for(var n in this.inputNode=s.context.createGain(),this.outputNode=s.context.createGain(),s.context.createStereoPanner?(this.pannerNode=s.context.createStereoPanner(),this.inputNode.connect(this.pannerNode),this.pannerNode.connect(this.outputNode)):s.context.createPanner?(console.warn("Your browser does not support the StereoPannerNode. Will use PannerNode instead."),this.pannerNode=s.context.createPanner(),this.pannerNode.type="equalpower",this.inputNode.connect(this.pannerNode),this.pannerNode.connect(this.outputNode)):(console.warn("Your browser does not support the Panner effect."),this.inputNode.connect(this.outputNode)),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]},s.Effects.StereoPanner.prototype=Object.create(l,{pan:{enumerable:!0,get:function(){return this.options.pan},set:function(e){r.Util.isInRange(e,-1,1)&&(this.options.pan=e,this.pannerNode)&&(this.pannerNode.toString().indexOf("StereoPannerNode")>-1?this.pannerNode.pan.value=e:this.pannerNode.setPosition(e,0,1-Math.abs(e)))}}}),s.Effects.Convolver=function(e,t){this.options={},e=e||this.options;var n=this,i=new XMLHttpRequest,o={mix:.5};for(var a in this.callback=t,this.inputNode=s.context.createGain(),this.convolverNode=s.context.createConvolver(),this.outputNode=s.context.createGain(),this.wetGainNode=s.context.createGain(),this.dryGainNode=s.context.createGain(),this.inputNode.connect(this.convolverNode),this.convolverNode.connect(this.wetGainNode),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.wetGainNode.connect(this.outputNode),o)this[a]=e[a],this[a]=void 0===this[a]||null===this[a]?o[a]:this[a];return e.impulse?(i.open("GET",e.impulse,!0),i.responseType="arraybuffer",i.onload=function(e){var t=e.target.response;s.context.decodeAudioData(t,(function(e){n.convolverNode.buffer=e,n.callback&&r.Util.isFunction(n.callback)&&n.callback()}),(function(e){e=e||new Error("Error decoding impulse file"),n.callback&&r.Util.isFunction(n.callback)&&n.callback(e)}))},i.onreadystatechange=function(t){4===i.readyState&&200!==i.status&&console.error("Error while fetching "+e.impulse+". "+i.statusText)},void i.send()):void console.error("No impulse file specified.")},s.Effects.Convolver.prototype=Object.create(l,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.mix=e,this.dryGainNode.gain.value=s.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=s.Util.getWetLevel(this.mix))}}}),s.Effects.PingPongDelay=function(e){this.options={},e=e||this.options;var t={feedback:.5,time:.3,mix:.5};for(var n in this.inputNode=s.context.createGain(),this.outputNode=s.context.createGain(),this.delayNodeLeft=s.context.createDelay(),this.delayNodeRight=s.context.createDelay(),this.dryGainNode=s.context.createGain(),this.wetGainNode=s.context.createGain(),this.feedbackGainNode=s.context.createGain(),this.channelMerger=s.context.createChannelMerger(2),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.delayNodeLeft.connect(this.channelMerger,0,0),this.delayNodeRight.connect(this.channelMerger,0,1),this.delayNodeLeft.connect(this.delayNodeRight),this.feedbackGainNode.connect(this.delayNodeLeft),this.delayNodeRight.connect(this.feedbackGainNode),this.inputNode.connect(this.feedbackGainNode),this.channelMerger.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]},s.Effects.PingPongDelay.prototype=Object.create(l,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.mix=e,this.dryGainNode.gain.value=s.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=s.Util.getWetLevel(this.mix))}},time:{enumerable:!0,get:function(){return this.options.time},set:function(e){r.Util.isInRange(e,0,180)&&(this.options.time=e,this.delayNodeLeft.delayTime.value=e,this.delayNodeRight.delayTime.value=e)}},feedback:{enumerable:!0,get:function(){return this.options.feedback},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.feedback=parseFloat(e,10),this.feedbackGainNode.gain.value=this.feedback)}}}),s.Effects.Reverb=function(e){this.options={},e=e||this.options;var t={mix:.5,time:.01,decay:.01,reverse:!1};for(var n in this.inputNode=s.context.createGain(),this.reverbNode=s.context.createConvolver(),this.outputNode=s.context.createGain(),this.wetGainNode=s.context.createGain(),this.dryGainNode=s.context.createGain(),this.inputNode.connect(this.reverbNode),this.reverbNode.connect(this.wetGainNode),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.wetGainNode.connect(this.outputNode),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n];i.bind(this)()},s.Effects.Reverb.prototype=Object.create(l,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.mix=e,this.dryGainNode.gain.value=s.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=s.Util.getWetLevel(this.mix))}},time:{enumerable:!0,get:function(){return this.options.time},set:function(e){r.Util.isInRange(e,1e-4,10)&&(this.options.time=e,i.bind(this)())}},decay:{enumerable:!0,get:function(){return this.options.decay},set:function(e){r.Util.isInRange(e,1e-4,10)&&(this.options.decay=e,i.bind(this)())}},reverse:{enumerable:!0,get:function(){return this.options.reverse},set:function(e){r.Util.isBool(e)&&(this.options.reverse=e,i.bind(this)())}}}),s.Effects.Tremolo=function(e){this.options={},e=e||this.options;var t={speed:4,depth:1,mix:.8};for(var n in this.inputNode=s.context.createGain(),this.outputNode=s.context.createGain(),this.dryGainNode=s.context.createGain(),this.wetGainNode=s.context.createGain(),this.tremoloGainNode=s.context.createGain(),this.tremoloGainNode.gain.value=0,this.lfoNode=s.context.createOscillator(),this.shaperNode=s.context.createWaveShaper(),this.shaperNode.curve=new Float32Array([0,1]),this.shaperNode.connect(this.tremoloGainNode.gain),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.lfoNode.connect(this.shaperNode),this.lfoNode.type="sine",this.lfoNode.start(0),this.inputNode.connect(this.tremoloGainNode),this.tremoloGainNode.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]},s.Effects.Tremolo.prototype=Object.create(l,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.mix=e,this.dryGainNode.gain.value=s.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=s.Util.getWetLevel(this.mix))}},speed:{enumerable:!0,get:function(){return this.options.speed},set:function(e){r.Util.isInRange(e,0,20)&&(this.options.speed=e,this.lfoNode.frequency.value=e)}},depth:{enumerable:!0,get:function(){return this.options.depth},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.depth=e,this.shaperNode.curve=new Float32Array([1-e,1]))}}}),s.Effects.DubDelay=function(e){this.options={},e=e||this.options;var t={feedback:.6,time:.7,mix:.5,cutoff:700};for(var n in this.inputNode=s.context.createGain(),this.outputNode=s.context.createGain(),this.dryGainNode=s.context.createGain(),this.wetGainNode=s.context.createGain(),this.feedbackGainNode=s.context.createGain(),this.delayNode=s.context.createDelay(),this.bqFilterNode=s.context.createBiquadFilter(),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.inputNode.connect(this.wetGainNode),this.inputNode.connect(this.feedbackGainNode),this.feedbackGainNode.connect(this.bqFilterNode),this.bqFilterNode.connect(this.delayNode),this.delayNode.connect(this.feedbackGainNode),this.delayNode.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]},s.Effects.DubDelay.prototype=Object.create(l,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.mix=e,this.dryGainNode.gain.value=s.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=s.Util.getWetLevel(this.mix))}},time:{enumerable:!0,get:function(){return this.options.time},set:function(e){r.Util.isInRange(e,0,180)&&(this.options.time=e,this.delayNode.delayTime.value=e)}},feedback:{enumerable:!0,get:function(){return this.options.feedback},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.feedback=parseFloat(e,10),this.feedbackGainNode.gain.value=this.feedback)}},cutoff:{enumerable:!0,get:function(){return this.options.cutoff},set:function(e){r.Util.isInRange(e,0,4e3)&&(this.options.cutoff=e,this.bqFilterNode.frequency.value=this.cutoff)}}}),s.Effects.RingModulator=function(e){this.options={},e=e||this.options;var t={speed:30,distortion:1,mix:.5};for(var n in this.inputNode=s.context.createGain(),this.outputNode=s.context.createGain(),this.dryGainNode=s.context.createGain(),this.wetGainNode=s.context.createGain(),this.vIn=s.context.createOscillator(),this.vIn.start(0),this.vInGain=s.context.createGain(),this.vInGain.gain.value=.5,this.vInInverter1=s.context.createGain(),this.vInInverter1.gain.value=-1,this.vInInverter2=s.context.createGain(),this.vInInverter2.gain.value=-1,this.vInDiode1=new p(s.context),this.vInDiode2=new p(s.context),this.vInInverter3=s.context.createGain(),this.vInInverter3.gain.value=-1,this.vcInverter1=s.context.createGain(),this.vcInverter1.gain.value=-1,this.vcDiode3=new p(s.context),this.vcDiode4=new p(s.context),this.outGain=s.context.createGain(),this.outGain.gain.value=3,this.compressor=s.context.createDynamicsCompressor(),this.compressor.threshold.value=-24,this.compressor.ratio.value=16,this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.inputNode.connect(this.vcInverter1),this.inputNode.connect(this.vcDiode4.node),this.vcInverter1.connect(this.vcDiode3.node),this.vIn.connect(this.vInGain),this.vInGain.connect(this.vInInverter1),this.vInGain.connect(this.vcInverter1),this.vInGain.connect(this.vcDiode4.node),this.vInInverter1.connect(this.vInInverter2),this.vInInverter1.connect(this.vInDiode2.node),this.vInInverter2.connect(this.vInDiode1.node),this.vInDiode1.connect(this.vInInverter3),this.vInDiode2.connect(this.vInInverter3),this.vInInverter3.connect(this.compressor),this.vcDiode3.connect(this.compressor),this.vcDiode4.connect(this.compressor),this.compressor.connect(this.outGain),this.outGain.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),t)this[n]=e[n],this[n]=void 0===this[n]||null===this[n]?t[n]:this[n]};var p=function(e){this.context=e,this.node=this.context.createWaveShaper(),this.vb=.2,this.vl=.4,this.h=1,this.setCurve()};return p.prototype.setDistortion=function(e){return this.h=e,this.setCurve()},p.prototype.setCurve=function(){var e,t,n,i,o,s,r;for(t=1024,e=s=0,r=(o=new Float32Array(t)).length;r>=0?r>s:s>r;e=r>=0?++s:--s)n=(e-512)/512,i=(n=Math.abs(n))<=this.vb?0:this.vb<n&&n<=this.vl?this.h*(Math.pow(n-this.vb,2)/(2*this.vl-2*this.vb)):this.h*n-this.h*this.vl+this.h*(Math.pow(this.vl-this.vb,2)/(2*this.vl-2*this.vb)),o[e]=i;return this.node.curve=o},p.prototype.connect=function(e){return this.node.connect(e)},s.Effects.RingModulator.prototype=Object.create(l,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.mix=e,this.dryGainNode.gain.value=s.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=s.Util.getWetLevel(this.mix))}},speed:{enumerable:!0,get:function(){return this.options.speed},set:function(e){r.Util.isInRange(e,0,2e3)&&(this.options.speed=e,this.vIn.frequency.value=e)}},distortion:{enumerable:!0,get:function(){return this.options.distortion},set:function(e){if(r.Util.isInRange(e,.2,50)){this.options.distortion=parseFloat(e,10);for(var t=[this.vInDiode1,this.vInDiode2,this.vcDiode3,this.vcDiode4],n=0,i=t.length;i>n;n++)t[n].setDistortion(e)}}}}),s.Effects.Quadrafuzz=function(e){this.options={},e=e||this.options;var t={lowGain:.6,midLowGain:.8,midHighGain:.5,highGain:.6};this.inputNode=r.context.createGain(),this.outputNode=r.context.createGain(),this.dryGainNode=r.context.createGain(),this.wetGainNode=r.context.createGain(),this.lowpassLeft=r.context.createBiquadFilter(),this.lowpassLeft.type="lowpass",this.lowpassLeft.frequency.value=147,this.lowpassLeft.Q.value=.7071,this.bandpass1Left=r.context.createBiquadFilter(),this.bandpass1Left.type="bandpass",this.bandpass1Left.frequency.value=587,this.bandpass1Left.Q.value=.7071,this.bandpass2Left=r.context.createBiquadFilter(),this.bandpass2Left.type="bandpass",this.bandpass2Left.frequency.value=2490,this.bandpass2Left.Q.value=.7071,this.highpassLeft=r.context.createBiquadFilter(),this.highpassLeft.type="highpass",this.highpassLeft.frequency.value=4980,this.highpassLeft.Q.value=.7071,this.overdrives=[];for(var n=0;4>n;n++)this.overdrives[n]=r.context.createWaveShaper(),this.overdrives[n].curve=o();this.inputNode.connect(this.wetGainNode),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode);var i=[this.lowpassLeft,this.bandpass1Left,this.bandpass2Left,this.highpassLeft];for(n=0;n<i.length;n++)this.wetGainNode.connect(i[n]),i[n].connect(this.overdrives[n]),this.overdrives[n].connect(this.outputNode);for(var s in t)this[s]=e[s],this[s]=void 0===this[s]||null===this[s]?t[s]:this[s]},s.Effects.Quadrafuzz.prototype=Object.create(l,{lowGain:{enumerable:!0,get:function(){return this.options.lowGain},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.lowGain=e,this.overdrives[0].curve=o(r.Util.normalize(this.lowGain,0,150)))}},midLowGain:{enumerable:!0,get:function(){return this.options.midLowGain},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.midLowGain=e,this.overdrives[1].curve=o(r.Util.normalize(this.midLowGain,0,150)))}},midHighGain:{enumerable:!0,get:function(){return this.options.midHighGain},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.midHighGain=e,this.overdrives[2].curve=o(r.Util.normalize(this.midHighGain,0,150)))}},highGain:{enumerable:!0,get:function(){return this.options.highGain},set:function(e){r.Util.isInRange(e,0,1)&&(this.options.highGain=e,this.overdrives[3].curve=o(r.Util.normalize(this.highGain,0,150)))}}}),s}console.error("No AudioContext found in this environment. Please ensure your window or global object contains a working AudioContext constructor function.")}("undefined"!=typeof window?window:te)},ne(ie={exports:{}},ie.exports),ie.exports);let se,re,ae,ce,ue,de,he;function le(){const e=new AudioWorkletNode(se,"soundwave-processor",{processorOptions:de});return e.port.onmessage=e=>{!function(e){const{id:t,data:n}=e;if("waveData"===t)ue(n);else console.warn("unknown processor message",e)}(e.data)},e}function fe(e){e&&(e.off(),e.stop(),e.disconnect())}function pe(e){me("sweepTime",e)}function ve(e){me("fps",e)}function me(e,t){ce&&ce.port.postMessage({id:e,data:t})}function ge(e){let t,n,i,o,s,r;function a(t){e[5](t)}let d={title:"WAVE TYPE",outputValue:e[4],max:4,min:1,pixelRange:200};function h(t){e[6](t)}void 0!==e[3]&&(d.value=e[3]),t=new ee({props:d}),G.push((()=>F(t,"value",a)));let f={title:"FREQUENCY",unit:"Hz",max:5e3,min:60,pixelRange:200};return void 0!==e[2]&&(f.value=e[2]),o=new ee({props:f}),G.push((()=>F(o,"value",h))),{c(){A(t.$$.fragment),i=l(),A(o.$$.fragment)},m(e,n){z(t,e,n),c(e,i,n),z(o,e,n),r=!0},p(e,i){const r={};16&i&&(r.outputValue=e[4]),!n&&8&i&&(n=!0,r.value=e[3],k((()=>n=!1))),t.$set(r);const a={};!s&&4&i&&(s=!0,a.value=e[2],k((()=>s=!1))),o.$set(a)},i(e){r||(j(t.$$.fragment,e),j(o.$$.fragment,e),r=!0)},o(e){M(t.$$.fragment,e),M(o.$$.fragment,e),r=!1},d(e){q(t,e),e&&u(i),q(o,e)}}}function Ne(e){let t,n;return t=new J({props:{heading:"SOUNDWAVE",isOpen:!0,removeHandler:e[7],$$slots:{default:[ge]},$$scope:{ctx:e}}}),{c(){A(t.$$.fragment)},m(e,i){z(t,e,i),n=!0},p(e,[n]){const i={};3&n&&(i.removeHandler=e[7]),1052&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(j(t.$$.fragment,e),n=!0)},o(e){M(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function be(e,t,n){let i,{sound:o}=t,{removeHandler:s}=t,r=80,a=1;const c=["sine","triangle","sawtooth","square"];function u(){const{soundwave:e,isPlaying:t}=o;fe(e),n(0,o.soundwave=function(e,t){const n=new oe.Sound({source:"wave",options:{type:e,frequency:t,detached:!0}});return n.masterVolume.connect(ae),n}(i,r),o),t&&o.soundwave.play()}u();return e.$$set=e=>{"sound"in e&&n(0,o=e.sound),"removeHandler"in e&&n(1,s=e.removeHandler)},e.$$.update=()=>{4&e.$$.dirty&&n(0,o.soundwave.frequency=r,o),8&e.$$.dirty&&(n(4,i=c[a-1]),u())},[o,s,r,a,i,function(e){a=e,n(3,a)},function(e){r=e,n(2,r)},()=>s(o)]}class ye extends _{constructor(e){super(),V(this,e,be,Ne,s,{sound:0,removeHandler:1})}}function xe(e){let t,n,i,o,s,r,a,d,h;function f(t){e[4](t)}let p={title:"⅟SAMPLE TIME",max:1e3,min:1,pixelRange:200};function v(t){e[5](t)}void 0!==e[2]&&(p.value=e[2]),t=new ee({props:p}),G.push((()=>F(t,"value",f)));let m={title:"FPS",max:120,min:1,pixelRange:200};function g(t){e[6](t)}void 0!==e[0]&&(m.value=e[0]),o=new ee({props:m}),G.push((()=>F(o,"value",v)));let N={title:"WAVES SHOWING",max:30,min:1,pixelRange:200};return void 0!==e[1]&&(N.value=e[1]),a=new ee({props:N}),G.push((()=>F(a,"value",g))),{c(){A(t.$$.fragment),i=l(),A(o.$$.fragment),r=l(),A(a.$$.fragment)},m(e,n){z(t,e,n),c(e,i,n),z(o,e,n),c(e,r,n),z(a,e,n),h=!0},p(e,i){const r={};!n&&4&i&&(n=!0,r.value=e[2],k((()=>n=!1))),t.$set(r);const c={};!s&&1&i&&(s=!0,c.value=e[0],k((()=>s=!1))),o.$set(c);const u={};!d&&2&i&&(d=!0,u.value=e[1],k((()=>d=!1))),a.$set(u)},i(e){h||(j(t.$$.fragment,e),j(o.$$.fragment,e),j(a.$$.fragment,e),h=!0)},o(e){M(t.$$.fragment,e),M(o.$$.fragment,e),M(a.$$.fragment,e),h=!1},d(e){q(t,e),e&&u(i),q(o,e),e&&u(r),q(a,e)}}}function Ge(e){let t,n;return t=new J({props:{heading:"VIEW PARAMETERS",isOpen:!0,$$slots:{default:[xe]},$$scope:{ctx:e}}}),{c(){A(t.$$.fragment)},m(e,i){z(t,e,i),n=!0},p(e,[n]){const i={};135&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(j(t.$$.fragment,e),n=!0)},o(e){M(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function we(e,t,n){let{sampleSize:i}=t,{fps:o=60}=t,{oldWavesDisplayed:s=10}=t,r=15;return e.$$set=e=>{"sampleSize"in e&&n(3,i=e.sampleSize),"fps"in e&&n(0,o=e.fps),"oldWavesDisplayed"in e&&n(1,s=e.oldWavesDisplayed)},e.$$.update=()=>{4&e.$$.dirty&&n(3,i=1/r)},[o,s,r,i,function(e){r=e,n(2,r)},function(e){o=e,n(0,o)},function(e){s=e,n(1,s)}]}class $e extends _{constructor(e){super(),V(this,e,we,Ge,s,{sampleSize:3,fps:0,oldWavesDisplayed:1})}}class Ie{constructor(){this.soundwave=null,this.isPlaying=!1}play(){this.isPlaying=!0,this.soundwave&&this.soundwave.play()}stop(){this.isPlaying=!1,this.soundwave&&this.soundwave.stop()}remove(){fe(this.soundwave)}}function Ue(t){let n,i;return{c(){n=d("div"),i=d("canvas"),p(i,"class","canvas svelte-qlemw4"),p(n,"class","canvasContainer center svelte-qlemw4")},m(e,o){c(e,n,o),a(n,i),t[3](i),t[4](n)},p:e,i:e,o:e,d(e){e&&u(n),t[3](null),t[4](null)}}}function Se(e){he(e)}function ke(e){const t=e.getContext("2d");return t.strokeStyle="#ff3e00",t.lineWidth=1,t}function Re(e,t,n,i){const{xSamples:o,ySamples:s}=e,r=i-100;return{x:n/2+o[t]*n,y:50+(.5+s[t]/2)*r}}function Ee(e,t,n){let{oldWavesDisplayed:i}=t;const o=[];let s,r,a,c,u,d=null;function h(e){e.width=s.clientWidth,e.height=.33*e.width}function l(e){d&&(clearTimeout(d),d=null);const{samplesLength:t,continueProcessing:n}=e,{width:s,height:r}=c;let a=Number.POSITIVE_INFINITY;u.clearRect(0,0,s,r),u.beginPath();for(let n=0;n<t;n++){const{x:t,y:i}=Re(e,n,s,r);t<a?u.moveTo(t,i):u.lineTo(t,i),a=t}u.stroke(),function(){const e=new Image;if(o.push(e),o.length>i){const e=o.length-i;o.splice(0,e)}e.onload=f,e.src=c.toDataURL()}(),n||p()}function f(){const{width:e,height:t}=r;a.clearRect(0,0,e,t),a.imageSmoothingEnabled=!0;const n=i/3;o.forEach(((i,o)=>{const s=Math.min((o+1)/n,1);a.globalAlpha=s.toString(10),a.drawImage(i,0,0,e,t)})),a.globalAlpha=1}function p(){console.log("fadeOutImage",d),!d&&o.length&&(d=setTimeout((()=>{o.splice(0,1),f(),d=null,p()}),16.666666666666668))}return y((()=>{h(r),a=ke(r),c=document.createElement("canvas"),h(c),u=ke(c),he=l})),e.$$set=e=>{"oldWavesDisplayed"in e&&n(2,i=e.oldWavesDisplayed)},[s,r,i,function(e){G[e?"unshift":"push"]((()=>{r=e,n(1,r)}))},function(e){G[e?"unshift":"push"]((()=>{s=e,n(0,s)}))}]}class Le extends _{constructor(e){super(),V(this,e,Ee,Ue,s,{oldWavesDisplayed:2})}}function De(e,t,n){const i=e.slice();return i[17]=t[n],i[18]=t,i[19]=n,i}function Te(e){let t;return{c(){t=h("play sound")},m(e,n){c(e,t,n)},d(e){e&&u(t)}}}function Oe(e){let t;return{c(){t=h("stop sound")},m(e,n){c(e,t,n)},d(e){e&&u(t)}}}function Pe(e){let t,n,i;function o(){return e[13](e[17])}function s(t){e[14](t,e[17],e[18],e[19])}let r={removeHandler:o};return void 0!==e[17]&&(r.sound=e[17]),t=new ye({props:r}),G.push((()=>F(t,"sound",s))),{c(){A(t.$$.fragment)},m(e,n){z(t,e,n),i=!0},p(i,s){e=i;const r={};32&s&&(r.removeHandler=o),!n&&32&s&&(n=!0,r.sound=e[17],k((()=>n=!1))),t.$set(r)},i(e){i||(j(t.$$.fragment,e),i=!0)},o(e){M(t.$$.fragment,e),i=!1},d(e){q(t,e)}}}function Ce(e){let t,n,o,s,r,a,p,v,m,g,N,b,y,x,w;function $(t){e[8](t)}function I(t){e[9](t)}function U(t){e[10](t)}let S={};void 0!==e[1]&&(S.sampleSize=e[1]),void 0!==e[3]&&(S.oldWavesDisplayed=e[3]),void 0!==e[2]&&(S.fps=e[2]),t=new $e({props:S}),G.push((()=>F(t,"sampleSize",$))),G.push((()=>F(t,"oldWavesDisplayed",I))),G.push((()=>F(t,"fps",U)));let R={oldWavesDisplayed:e[3]};function E(e,t){return e[0]?Oe:Te}a=new Le({props:R}),e[11](a);let L=E(e),D=L(e),T=e[5],O=[];for(let t=0;t<T.length;t+=1)O[t]=Pe(De(e,T,t));const W=e=>M(O[e],1,1,(()=>{O[e]=null}));return{c(){A(t.$$.fragment),r=l(),A(a.$$.fragment),p=l(),v=d("button"),D.c(),m=l(),g=d("button"),g.textContent="add a sound",N=l();for(let e=0;e<O.length;e+=1)O[e].c();b=h("")},m(n,i){z(t,n,i),c(n,r,i),z(a,n,i),c(n,p,i),c(n,v,i),D.m(v,null),c(n,m,i),c(n,g,i),c(n,N,i);for(let e=0;e<O.length;e+=1)O[e].m(n,i);c(n,b,i),y=!0,x||(w=[f(v,"click",e[12]),f(g,"click",e[6])],x=!0)},p(e,[i]){const r={};!n&&2&i&&(n=!0,r.sampleSize=e[1],k((()=>n=!1))),!o&&8&i&&(o=!0,r.oldWavesDisplayed=e[3],k((()=>o=!1))),!s&&4&i&&(s=!0,r.fps=e[2],k((()=>s=!1))),t.$set(r);const c={};if(8&i&&(c.oldWavesDisplayed=e[3]),a.$set(c),L!==(L=E(e))&&(D.d(1),D=L(e),D&&(D.c(),D.m(v,null))),160&i){let t;for(T=e[5],t=0;t<T.length;t+=1){const n=De(e,T,t);O[t]?(O[t].p(n,i),j(O[t],1)):(O[t]=Pe(n),O[t].c(),j(O[t],1),O[t].m(b.parentNode,b))}for(P(),t=T.length;t<O.length;t+=1)W(t);C()}},i(e){if(!y){j(t.$$.fragment,e),j(a.$$.fragment,e);for(let e=0;e<T.length;e+=1)j(O[e]);y=!0}},o(e){M(t.$$.fragment,e),M(a.$$.fragment,e),O=O.filter(Boolean);for(let e=0;e<O.length;e+=1)M(O[e]);y=!1},d(n){q(t,n),n&&u(r),e[11](null),q(a,n),n&&u(p),n&&u(v),D.d(),n&&u(m),n&&u(g),n&&u(N),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(O,n),n&&u(b),x=!1,i(w)}}}function je(e,t,n){let i,o,s,r,a=!1,c=[];function u(){(async function(){console.log("startSoundProcessor"),ce=le(),ae.connect(re),re.connect(ce),ce.connect(oe.masterGainNode)})().then((()=>{pe(i),ve(o),c.forEach((e=>e.play()))}))}function d(){c.forEach((e=>e.stop())),n(0,a=!1);setTimeout((()=>{a||(console.log("stopSoundProcessor"),ce&&(me("stop"),re.disconnect(ce),ce.disconnect(oe.masterGainNode)))}),600)}function h(e){const t=c.indexOf(e);if(t>-1){const{[t]:e,...i}=c;e.remove(),n(5,c=Object.values(i))}}y((()=>{!async function(e){ue=e,se=oe.context,re=new oe.Effects.Compressor,ae=se.createGain(),de={mainGain:oe.masterGainNode.gain.value,sampleRate:se.sampleRate},await se.audioWorklet.addModule("utils/SoundwaveProcessor.js")}(Se),n(5,c=c.concat(new Ie))}));return e.$$.update=()=>{1&e.$$.dirty&&(a?u():d()),2&e.$$.dirty&&pe(i),4&e.$$.dirty&&ve(o)},[a,i,o,s,r,c,function(){const e=new Ie;a&&e.play(),n(5,c=c.concat(e))},h,function(e){i=e,n(1,i)},function(e){s=e,n(3,s)},function(e){o=e,n(2,o)},function(e){G[e?"unshift":"push"]((()=>{r=e,n(4,r)}))},()=>n(0,a=!a),e=>h(e),function(e,t,i,o){i[o]=e,n(5,c)}]}class Me extends _{constructor(e){super(),V(this,e,je,Ce,s,{})}}function Fe(t){let n;return{c(){n=d("div"),n.textContent="click anywhere to start",p(n,"class","svelte-bjlk6c")},m(e,t){c(e,n,t)},i:e,o:e,d(e){e&&u(n)}}}function Ae(e){let t,n;return t=new Me({}),{c(){A(t.$$.fragment)},m(e,i){z(t,e,i),n=!0},i(e){n||(j(t.$$.fragment,e),n=!0)},o(e){M(t.$$.fragment,e),n=!1},d(e){q(t,e)}}}function ze(e){let t,n,i,o,s,r;const h=[Ae,Fe],f=[];function v(e,t){return e[0]?0:1}return o=v(e),s=f[o]=h[o](e),{c(){t=d("main"),n=d("h1"),n.textContent="JS SYNTH",i=l(),s.c(),p(n,"class","svelte-bjlk6c"),p(t,"class","svelte-bjlk6c")},m(e,s){c(e,t,s),a(t,n),a(t,i),f[o].m(t,null),r=!0},p(e,[n]){let i=o;o=v(e),o!==i&&(P(),M(f[i],1,1,(()=>{f[i]=null})),C(),s=f[o],s||(s=f[o]=h[o](e),s.c()),j(s,1),s.m(t,null))},i(e){r||(j(s),r=!0)},o(e){M(s),r=!1},d(e){e&&u(t),f[o].d()}}}function qe(e,t,n){let i=!1;return window.addEventListener("pointerup",(function e(){window.removeEventListener("pointerup",e),n(0,i=!0)})),[i]}return new class extends _{constructor(e){super(),V(this,e,qe,ze,s,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
